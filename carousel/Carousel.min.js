!function(t,e){if("function"==typeof define&&define.amd)define([],e);else if("undefined"!=typeof exports)e();else{var n={exports:{}};e(),t.Carousel=n.exports}}(this,function(){"use strict";!function(){function t(t){var e=hance.inherit("octopus.carousel.Carousel",function(){}),n=e.prototype;t(window),t(document);e.options={enableLoop:!0,enableTouch:!0,tweenDuration:.6,avoidChasse:!0,actived:!0,HaulierClass:i,haulier:null},e.cssClassName="otp-carousel",e.dataId="__otp_carousel";var i=hance.fetch("octopus.carousel.AdaptiveHaulier");return e.sync=function(){t("."+e.cssClassName).each(function(){e.get(this)||t(this).attr("otp-state")||new e(this)})},e.all=function(){var n=[];return t("."+e.cssClassName).each(function(){var t=e.get(this);t&&n.push(t)}),n},e.clean=function(){t("."+e.cssClassName).each(function(){var t=e.get(this);t&&t.useless()&&t.destroy()})},e.get=function(n){return t(n).data(e.dataId)},hance.properties(n,[{name:"currentIndex",getter:!0,setter:!1},{name:"dimension",getter:!0,setter:!1},{name:"sheetCount",getter:!0,setter:!1},{name:"interacted",getter:!0,setter:!1}]),n.init=function(n,o){if(this.$node=n.addClass("otp-carousel"),0===n.length)throw new Error("Element can not be empty!");if("built"!==n.attr("otp-state")){n.data(e.dataId,this);var o=this.options=t.extend({},e.options,n.data(),o);this._haulier=new i,this._haulier.serve(this),this._dragging=!1,this.$viewport=this.$node.find(".otp-viewport"),this.$overview=this.$viewport.find(".otp-overview"),this.$sheets=this.$node.find(".otp-sheet"),this._sheetCount=this.$sheets.length,this.cache={},this.refreshCache(),this.$sheets.each(function(e){t(this).data("otp-index",e)}),this._currentIndex=0,this.setCurrentIndex(0,!1,1,!1,!0),this.layout(),o.actived&&this.active()}},n.active=function(){this.addEventHandlers(),this.resumeAutoRun()},n.interact=function(){this._interacted||(t(this).trigger("interacted"),this._interacted=!0)},n.abort=function(){this.stopAutoRun(),this.removeEventHandlers()},n.startAutoRun=function(t){var e=this;clearInterval(this._autoRunIntervalId),void 0===t&&(t=this.options.interval||5),this._autoRunIntervalId=setInterval(function(){e._dragging||e._haulier.isAnimating()||e.next(!0)},1e3*t),this.options.interval=t},n.pauseAutoRun=function(){this._autoRunIntervalId&&clearInterval(this._autoRunIntervalId)},n.stopAutoRun=function(){this.pauseAutoRun(),this.options.interval=0},n.resumeAutoRun=function(){this.options.interval>0&&this.startAutoRun()},n.addEventHandlers=function(){var t=this;this.options.enableTouch&&Modernizr.touch&&this.$viewport.on("touchstart.carousel",function(e){t._startTouchX=e.originalEvent?e.originalEvent.touches[0].pageX:e.touches[0].pageX,t._startTouchY=e.originalEvent?e.originalEvent.touches[0].pageY:e.touches[0].pageY,t._touchTimer=Number(new Date),t._dragging=void 0,t._haulier.startDrag(t._startTouchX,t._startTouchY);var n=0,i=0,o=t.cache.viewport.width,r=t.$sheets.length;t.$viewport.on("touchmove.carousel",function(e){var s=e.originalEvent?e.originalEvent.touches[0]:e.touches[0];return n=s.pageX-t._startTouchX,i=s.pageY-t._startTouchY,n=Math.min(Math.max(n,-o),o),void 0===t._dragging&&Math.abs(Math.abs(n)-Math.abs(i))>3&&(t._dragging=Math.abs(n)>Math.abs(i)),t._currentTouchX=s.pageX,t._currentTouchY=s.pageY,void 0===t._dragging?(e.preventDefault(),e.stopPropagation()):t._dragging?(t.interact(),!t.options.enableLoop&&(0===t._currentIndex&&n>0||t._currentIndex===r-1&&0>n)&&(n*=.4),t._haulier.drag(n,i),e.preventDefault(),e.stopPropagation()):(console.log("============cancel drag"),t._haulier.cancelDrag(),t.$viewport.off("touchmove.carousel touchend.carousel"),void 0)}).on("touchend.carousel",function(e){return console.log("=============touch end",n),t._dragging?(t._dragging=!1,Math.abs(n)>.2*o||Math.abs(n)>.1*o&&Number(new Date)-t._touchTimer<250?n>0?0!==t._currentIndex||t.options.enableLoop?t.prev(!0,!0):t.park():t._currentIndex>=r-1&&!t.options.enableLoop?t.park():t.next(!0,!0):t.park(),t.$viewport.off("touchmove.carousel touchend.carousel"),t._haulier.stopDrag(),e.stopPropagation()):(t.park(),void t.$viewport.off("touchmove.carousel touchend.carousel"))})})},n.removeEventHandlers=function(){this.options.enableTouch&&this.$viewport.off(".carousel")},n.next=function(t,e){!this.options.enableLoop&&this._currentIndex>=this._sheetCount-1?this.setCurrentIndex(0,t,-1,e):this.setCurrentIndex(this._currentIndex+1,t,1,e)},n.prev=function(t,e){!this.options.enableLoop&&this._currentIndex<=0?this.setCurrentIndex(this._sheetCount-1,t,1,e):this.setCurrentIndex(this._currentIndex-1,t,-1,e)},n.park=function(){var t=(this._haulier.getActualIndex()%this._sheetCount+this._sheetCount)%this._sheetCount;this._currentIndex=Math.round(t)%this._sheetCount,this._haulier.setCurrentIndex(this._currentIndex,!0,0,!0)},n.setCurrentIndex=function(e,n,i,o,r){if(this._currentIndex===e&&!r||this._dragging)return!1;if(this._haulier.isAnimating()&&this.options.avoidChasse)return!1;var s=this.$sheets.length;!this.options.enableLoop&&(e>=s||0>e)&&(e=Math.max(0,Math.min(s-1,e))),this._haulier.setCurrentIndex(e,n,i,o,r),e=(e%s+s)%s;var a=t.Event("index");return a.oldIndex=this._currentIndex,a.newIndex=e,this._currentIndex=e,t(this).trigger(a,{oldIndex:this._currentIndex,newIndex:e}),!0},n.layout=function(t,e,n){this._haulier.layout(t,e,n),this.refreshCache()},n.refresh=function(){this.refreshCache()},n.refreshCache=function(){this.cache.viewport={width:this.$viewport.width(),height:this.$viewport.height()},this.cache.overview={width:this.$overview.width(),height:this.$overview.height()}},n.destroy=function(){this.removeEventHandlers(),this.$node.remove().data(e.dataId,null),this.$node=null},e}t($)}()});